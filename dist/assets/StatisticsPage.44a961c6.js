import{T as v,g as x,d as O,F as j,h as D,e as F}from"./index.1f81abc8.js";import{i as T}from"./echarts.c801cbb8.js";import{bF as d,by as p,bt as _,bs as w,bE as a,bU as u,bA as f}from"./vendor.728fe8e9.js";import"./vant.70689c2b.js";const M="_wrapper_kkstk_1",L={wrapper:M},C="_wrapper_wxcjg_1",I={wrapper:C},Y={tooltip:{show:!0,trigger:"axis",formatter:([e])=>{const[s,t]=e.data;return`${new v(new Date(s)).format("YYYY\u5E74MM\u6708DD\u65E5")} \uFFE5${x(t)}`}},grid:[{left:16,top:20,right:16,bottom:20}],xAxis:{type:"time",boundaryGap:["3%","0%"],axisLabel:{formatter:e=>new v(new Date(e)).format("MM-DD")},axisTick:{alignWithLabel:!0}},yAxis:{show:!0,type:"value",splitLine:{show:!0,lineStyle:{type:"dashed"}},axisLabel:{show:!1}}},E=d({props:{data:{type:Array,required:!0}},setup:(e,s)=>{const t=p();let r;return _(()=>{t.value!==void 0&&(r=T(t.value),r.setOption({...Y,series:[{data:e.data,type:"line"}]}))}),w(()=>e.data,()=>{r==null||r.setOption({series:[{data:e.data}]})}),()=>a("div",{ref:t,class:I.wrapper},null)}}),V="_wrapper_1cm6i_1",B={wrapper:V},N={tooltip:{trigger:"item",formatter:e=>{const{name:s,value:t,percent:r}=e;return`${s}: \uFFE5${x(t)} \u5360\u6BD4 ${r}%`}},grid:[{left:0,top:0,right:0,bottom:0}],series:[{type:"pie",radius:"70%",emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]},P=d({props:{data:{type:Array}},setup:(e,s)=>{const t=p();let r;return _(()=>{t.value!==void 0&&(r=T(t.value),r.setOption(N))}),w(()=>e.data,()=>{r==null||r.setOption({series:[{data:e.data}]})}),()=>a("div",{ref:t,class:B.wrapper},null)}}),U="_wrapper_3j8qr_1",G="_topItem_3j8qr_5",W="_sign_3j8qr_11",X="_bar_wrapper_3j8qr_22",z="_bar_text_3j8qr_27",H="_bar_3j8qr_22",J="_bar_inner_3j8qr_41",i={wrapper:U,topItem:G,sign:W,bar_wrapper:X,bar_text:z,bar:H,bar_inner:J},K=d({props:{data:{type:Array}},setup:(e,s)=>()=>a("div",{class:i.wrapper},[e.data&&e.data.length>0?e.data.map(({tag:t,amount:r,percent:l})=>a("div",{class:i.topItem},[a("div",{class:i.sign},[t.sign]),a("div",{class:i.bar_wrapper},[a("div",{class:i.bar_text},[a("span",null,[u(" "),t.name,u(" - "),l,u("% ")]),a("span",null,[u(" \uFFE5"),a(O,{value:r},null),u(" ")])]),a("div",{class:i.bar},[a("div",{class:i.bar_inner,style:{width:`${l}%`}},null)])])])):a("div",null,[u("\u6CA1\u6709\u6570\u636E")])])}),Q=24*3600*1e3,R=d({props:{startDate:{type:String,required:!1},endDate:{type:String,required:!1}},setup:(e,s)=>{const t=p("expenses"),r=p([]),l=p(!0),$=f(()=>{if(!e.startDate||!e.endDate)return[];const o=(new Date(e.endDate).getTime()-new Date(e.startDate).getTime())/Q+1;return Array.from({length:o}).map((m,k)=>{const y=new v(e.startDate+"T00:00:00.000+0800").add(k,"day").getTimestamp(),h=r.value[0],A=h&&new Date(h.happen_at+"T00:00:00.000+0800").getTime()===y?r.value.shift().amount:0;return[new Date(y).toISOString(),A]})}),b=async()=>{const n=await D.get("/items/summary",{happen_after:e.startDate,happen_before:e.endDate,kind:t.value,group_by:"happen_at"},{_mock:"itemSummary",_autoLoading:!0});r.value=n.data.groups};_(b),w(()=>[t.value,e],n=>{const{startDate:o,endDate:m}=n[1];o&&m?(l.value=!0,b(),g()):l.value=!1},{immediate:!0,deep:!0});const c=p([]),q=f(()=>c.value.map(n=>({name:n.tag.name,value:n.amount}))),S=f(()=>{const n=c.value.reduce((o,m)=>o+m.amount,0);return c.value.map(o=>({...o,percent:Math.round(o.amount/n*100)}))});async function g(){const n=await D.get("/items/summary",{happen_after:e.startDate,happen_before:e.endDate,kind:t.value,group_by:"tag_id"},{_mock:"itemSummary"});c.value=n.data.groups}return _(g),()=>l.value?a("div",{class:L.wrapper},[a(j,{label:"\u7C7B\u578B",type:"select",options:[{value:"expenses",text:"\u652F\u51FA"},{value:"income",text:"\u6536\u5165"}],modelValue:t.value,"onUpdate:modelValue":n=>t.value=n},null),a(E,{data:$.value},null),a(P,{data:q.value},null),a(K,{data:S.value},null)]):a("div",null,[u("\u8BF7\u9009\u62E9\u65F6\u95F4")])}}),re=d({setup:(e,s)=>()=>a(F,{rerenderOnSwitchTab:!0,component:R,hideThisYear:!0},null)});export{re as StatisticsPage,re as default};
